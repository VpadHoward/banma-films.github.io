<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ—Ñ–∏–ª—å | BANMA FILMS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">BANMA FILMS</div>
        <nav><a href="index.html">–°–µ—Ä–∏–∏</a><a href="profile.html" class="active" onclick="resetProfileView()">–ü—Ä–æ—Ñ–∏–ª—å</a></nav>
    </header>

    <main class="container" style="margin-top: 120px; max-width: 500px;">
        <div id="auth-forms">
            <div class="section-header"><h2>–í–•–û–î / –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</h2></div>
            <div class="comment-form">
                <input type="text" id="auth-login" placeholder="–õ–æ–≥–∏–Ω">
                <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                <div style="display:flex; gap:10px;">
                    <button onclick="handleAuth('login')" style="flex:1;">–í–æ–π—Ç–∏</button>
                    <button onclick="handleAuth('reg')" style="flex:1; background:var(--bg-card); border:1px solid var(--accent);">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
            </div>
        </div>

        <div id="user-profile" style="display:none;">
            <div class="section-header"><h2 id="profile-header-title">–í–ê–® –ü–†–û–§–ò–õ–¨</h2></div>
            <div class="profile-card">
                <div class="avatar-upload">
                    <img id="profile-avatar-preview" src="https://via.placeholder.com/150">
                    <input type="file" id="avatar-input" accept="image/*" onchange="uploadAvatar()">
                    <label for="avatar-input" id="avatar-label">–°–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ</label>
                </div>
                <h2 id="user-name-display" style="color: var(--gold); margin: 15px 0;"></h2>
                
                <div class="achievements-section">
                    <h3>–î–û–°–¢–ò–ñ–ï–ù–ò–Ø</h3>
                    <div class="achievements-grid">
                        <div id="ach-detective" class="achievement locked">
                            <div class="ach-icon">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                            <div class="ach-info">
                                <strong>–î–µ—Ç–µ–∫—Ç–∏–≤</strong>
                                <span>–ù–∞–π–¥–∏—Ç–µ –≤—Å–µ 5 —Å–∫—Ä—ã—Ç—ã—Ö –ø–∞—Å—Ö–∞–ª–æ–∫ –Ω–∞ —Å–∞–π—Ç–µ.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="owner-controls">
                    <button onclick="logout()" style="background:#ff4444; width:100%; margin-top:20px;">–í—ã–π—Ç–∏</button>
                </div>
                <div id="guest-controls" style="display:none;">
                    <button onclick="resetProfileView()" style="background:var(--accent); width:100%; margin-top:20px;">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
                </div>
            </div>
        </div>
    </main>

    <script src="auth-logic.js"></script>
    <script>
        function resetProfileView() {
            localStorage.removeItem('view_target_user');
            location.reload();
        }

        function updateUI() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const targetUserName = localStorage.getItem('view_target_user');
            
            // –ï—Å–ª–∏ –º—ã —Å–º–æ—Ç—Ä–∏–º —á—É–∂–æ–π –ø—Ä–æ—Ñ–∏–ª—å, –∏—â–µ–º –µ–≥–æ –≤ –±–∞–∑–µ
            let displayUser = currentUser;
            let isOwner = true;

            if (targetUserName && (!currentUser || targetUserName !== currentUser.login)) {
                const allUsers = JSON.parse(localStorage.getItem('banma_users')) || [];
                const foundUser = allUsers.find(u => u.login === targetUserName);
                if (foundUser) {
                    displayUser = foundUser;
                    isOwner = false;
                }
            }

            if (displayUser || (targetUserName && !currentUser)) { 
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å (—Å–≤–æ–π –∏–ª–∏ —á—É–∂–æ–π)
                document.getElementById('auth-forms').style.display = "none";
                document.getElementById('user-profile').style.display = "block";
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                document.getElementById('user-name-display').innerText = displayUser.login;
                document.getElementById('profile-avatar-preview').src = displayUser.avatar ? displayUser.avatar : 'https://via.placeholder.com/150';

                // –ê—á–∏–≤–∫–∏ —Ç–æ–≥–æ, –∫–æ–≥–æ —Å–º–æ—Ç—Ä–∏–º
                const found = JSON.parse(localStorage.getItem('found_eggs_' + displayUser.login)) || [];
                if (found.length >= 5) {
                    document.getElementById('ach-detective').classList.replace('locked', 'unlocked');
                } else {
                     document.getElementById('ach-detective').classList.replace('unlocked', 'locked');
                }

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (—Å–≤–æ–π/—á—É–∂–æ–π)
                if (isOwner) {
                    document.getElementById('profile-header-title').innerText = "–í–ê–® –ü–†–û–§–ò–õ–¨";
                    document.getElementById('avatar-label').style.display = 'block';
                    document.getElementById('owner-controls').style.display = 'block';
                    document.getElementById('guest-controls').style.display = 'none';
                } else {
                    document.getElementById('profile-header-title').innerText = "–ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø";
                    document.getElementById('avatar-label').style.display = 'none'; // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É —Å–º–µ–Ω—ã —Ñ–æ—Ç–æ
                    document.getElementById('owner-controls').style.display = 'none'; // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
                    document.getElementById('guest-controls').style.display = 'block';
                }

            } else {
                // –ï—Å–ª–∏ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –∏ –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∏–∫–æ–≥–æ
                document.getElementById('auth-forms').style.display = "block";
                document.getElementById('user-profile').style.display = "none";
            }
        }

        function uploadAvatar() {
            const input = document.getElementById('avatar-input');
            const reader = new FileReader();
            reader.onload = function() {
                const base64 = reader.result;
                let user = JSON.parse(localStorage.getItem('currentUser'));
                user.avatar = base64;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                let users = JSON.parse(localStorage.getItem('banma_users'));
                let idx = users.findIndex(u => u.login === user.login);
                if (idx !== -1) {
                    users[idx].avatar = base64;
                    localStorage.setItem('banma_users', JSON.stringify(users));
                }
                document.getElementById('profile-avatar-preview').src = base64;
            }
            reader.readAsDataURL(input.files[0]);
        }

        function logout() { localStorage.removeItem('currentUser'); location.reload(); }
        window.onload = updateUI;
    </script>
</body>
</html>